<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Kitaplık</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .info { background: #e3f2fd; color: #1565c0; }
    </style>
</head>
<body>
    <h1>Debug - Kitaplık Veri Yükleme</h1>
    <div id="logs"></div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        const logs = document.getElementById('logs');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            logs.appendChild(div);
            console.log(message);
        }
        
        async function testFiles() {
            log('Debug testi başlatılıyor...', 'info');
            
            const filesToTry = [
                { url: 'kitaplar.zip', type: 'zip', description: 'Ana veritabanı (sıkıştırılmış)' },
                { url: 'sample_kitaplar.csv', type: 'csv', description: 'Örnek veritabanı' }
            ];
            
            for (const fileInfo of filesToTry) {
                try {
                    log(`${fileInfo.description} test ediliyor: ${fileInfo.url}`, 'info');
                    
                    const response = await fetch(fileInfo.url);
                    log(`HTTP Status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                    
                    if (!response.ok) {
                        log(`❌ ${fileInfo.url} yüklenemedi - HTTP ${response.status}`, 'error');
                        continue;
                    }
                    
                    const contentType = response.headers.get('content-type') || 'unknown';
                    const contentLength = response.headers.get('content-length') || 'unknown';
                    log(`Content-Type: ${contentType}, Size: ${contentLength} bytes`, 'info');
                    
                    if (fileInfo.type === 'zip') {
                        const arrayBuffer = await response.arrayBuffer();
                        log(`ZIP dosyası indirildi: ${arrayBuffer.byteLength} bytes`, 'success');
                        
                        const zip = new JSZip();
                        const zipContent = await zip.loadAsync(arrayBuffer);
                        
                        const csvFiles = Object.keys(zipContent.files).filter(name => name.endsWith('.csv'));
                        log(`ZIP içinde ${csvFiles.length} CSV dosyası bulundu: ${csvFiles.join(', ')}`, 'success');
                        
                        if (csvFiles.length > 0) {
                            const csvText = await zipContent.files[csvFiles[0]].async('text');
                            const lines = csvText.split('\n').filter(line => line.trim());
                            log(`✅ ${fileInfo.url} başarıyla yüklendi - ${lines.length} satır`, 'success');
                            log(`İlk satır: ${lines[0]}`, 'info');
                            log(`İkinci satır: ${lines[1] || 'Yok'}`, 'info');
                            break;
                        }
                    } else {
                        const text = await response.text();
                        const lines = text.split('\n').filter(line => line.trim());
                        log(`✅ ${fileInfo.url} başarıyla yüklendi - ${lines.length} satır`, 'success');
                        log(`İlk satır: ${lines[0]}`, 'info');
                        log(`İkinci satır: ${lines[1] || 'Yok'}`, 'info');
                        break;
                    }
                    
                } catch (error) {
                    log(`❌ ${fileInfo.url} hata: ${error.message}`, 'error');
                }
            }
            
            log('Debug testi tamamlandı.', 'info');
        }
        
        // Sayfat yüklendiğinde test et
        window.addEventListener('load', testFiles);
    </script>
</body>
</html>